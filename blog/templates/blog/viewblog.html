{% extends "./base.html" %}

{% block content %}

    <h2>{{ blog.blog_title }}</h2>
    <p>Viewed {{ blog.view_count }} times</p>

    {% if self %}
        <form action="{% url 'blog:blog' blog.id 'delete' %}" method="post">
            {% csrf_token %}
            ---
            <button type="submit">Delete</button>
        </form>
    {% endif %}
    {% if not blog.fwd_blog %}
        <label>Author: {{ blog.blog_author.username }}</label><br>
        <label>Publish date: {{ blog.blog_postdate }}</label>
        <p>Content: <br>{{ blog.blog_content }}</p>
    {% else %}
        <label>Forward comment: {{ blog.blog_title }}</label><br>
        <label>Forward date: {{ blog.blog_postdate }}</label><br>
        <label>{{ blog.fwd_blog.blog_author.username }}</label><br>
        <label>Publish date: {{ blog.fwd_blog.blog_postdate }}</label>
        <p>Content: <br>{{ blog.fwd_blog.blog_content }}</p>
    {% endif %}

    {% if music %}
        <audio src="/{{ music }}" controls="controls"></audio>
    {% endif %}

    <form action="{% url 'blog:blog' blog.id 'forward' %}" method="post">
        {% csrf_token %}
        Forward message: <input type="text" name="fwdcontent"/>
        Private: <input type="radio" name="fwdprivate" value=1>True</input>
        <input type="radio" name="fwdprivate" value=0>False</input><br>
        <button type="submit">Forward ({{ blog.forward_count }})</button>
    </form>
    <br>

    {% if request.user %}
        <form action="{% url 'blog:blog' blog.id 'like' %}" method="post">
            <button type="submit">
                {% csrf_token %}
                {% if liked %}
                    Liked
                {% else %}
                    Like
                {% endif %}
                ({{ blog.like_count }})
            </button>
        </form>
        <br>
    {% endif %}

    <a href="{% url 'blog:user' blog.blog_author.id 'homepage' %}">Back</a>

    {% block comment %}

        {% if comment_error %}
            <h3>{{ comment_error }}</h3>
        {% endif %}
        <form action="{% url 'blog:blog' blog.id 'comment' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="comment_author_id" value="{{ request.user.id }}"/>
            <label>Comment:</label>
            <input type="text" name="content"/>
            <input type="submit" name="Submit"/>
        </form>

    {% endblock %}

    {% block commentindex %}

        <h3>Comments ({{ blog.comment_count }}):</h3>
        <ul>
            {% for comment in comment_list %}
                <li>{{ comment.comment_author.username }} - {{ comment.comment_date }} -
                    {% if self %}
                        <form action="{% url 'blog:comment' comment.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit">Delete</button>
                        </form>
                    {% endif %}
                </li>
                <P>{{ comment.comment_content }}</P>
            {% endfor %}
        </ul>
    {% endblock %}

{% endblock %}
